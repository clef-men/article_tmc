\RequirePackage{listings}
\RequirePackage{color}
\RequirePackage{amstext}

\definecolor{ocamlKeyword1}{rgb}{0,0.1,0.6}
\definecolor{ocamlKeyword2}{rgb}{0,0.4,0.4}

\lstdefinelanguage{Ocaml}{
    keepspaces=true,
    texcl=false,
    sensitive=true,
    showstringspaces=false,
    tabsize=2,
    extendedchars=false,
    breaklines=false,
    basicstyle=\small,
    captionpos=b,
    flexiblecolumns=false,
%
    morecomment=[n]{/*}{*/},
    commentstyle={\ttfamily\color{red!60!black}},
%
    alsoletter={
        '
    },
%
    identifierstyle={\ttfamily\color{black}},
%
    keywords=[1]{
        and,
        as,
        assert,
        asr,
        begin,
        class,
        closed,
        constraint,
        do,
        done,
        downto,
        else,
        end,
        external,
        false,
        for,
        fun,
        function,
        functor,
        if,
        in,
        include,
        inherit,
        land,
        lazy,
        let,
        lor,
        lsl,
        lsr,
        lxor,
        match,
        method,
        mod,
        module,
        mutable,
        new,
        not,
        object,
        of,
        open,
        or,
        parser,
        private,
        rec,
        repeat,
        sig,
        struct,
        then,
        to,
        true,
        try,
        type,
        val,
        virtual,
        when,
        while,
        with,
    },
    keywordstyle=[1]{\ttfamily\color{ocamlKeyword1}},
%
    literate=*
        {-}{$-$}1
        {|}{{\textcolor{ocamlKeyword1}{|}}}1
        {;}{{\textcolor{ocamlKeyword1}{;}}}1
        {->}{{$\textcolor{ocamlKeyword1}{\rightarrow}$}}2
        {(}{{\textcolor{ocamlKeyword2}{(}}}1
        {)}{{\textcolor{ocamlKeyword2}{)}}}1
        {\{}{{\textcolor{ocamlKeyword2}{\{}}}1
        {\}}{{\textcolor{ocamlKeyword2}{\}}}}1
        {[}{{\textcolor{ocamlKeyword2}{[}}}1
        {]}{{\textcolor{ocamlKeyword2}{]}}}1
        {.}{{\textcolor{ocamlKeyword2}{.}}}1
        {:}{{\textcolor{ocamlKeyword2}{:}}}1
        {,}{{\textcolor{ocamlKeyword2}{,}}}1
        {<-}{{$\textcolor{ocamlKeyword2}{\ \leftarrow\ }$}}1
        {?}{{$\blacksquare$}}1,
%
    morestring=[b]",
    stringstyle=\ttfamily,
}

\lstnewenvironment{Ocaml}[1][]{%
    \lstset{
        language=Ocaml,
        mathescape=true,
        basicstyle=\ttfamily\normalsize,
        moredelim=[is][\color{red}]{/[}{]/},
        #1
}%
}{}

\def\ocaml{%
    \lstinline[
        language=Ocaml,
        mathescape=true,
        basicstyle=\ttfamily\small
    ]%
}
\newcommand{\ocamlText}[1]{%
    \text{\ocaml|#1|}%
}